pipeline {
    agent any

    stages {
        stage('docker-login') {
            steps {
                withCredentials([
                    usernamePassword(
                        credentialsId: 'docker-creds',
                        usernameVariable: 'Docker_User',
                        passwordVariable: 'Docker_Pass'
                        
                        )
                    ])
                    {
                         sh '''
                                  echo "$Docker_Pass" | docker login -u "$Docker_User" --password-stdin
                             '''
                    }
            }
        }
        stage('build images') {
            steps {
                sh '''
                    docker compose build --no-cache
                '''
            }
        }
        stage ('push-images-to-docker-hub') {
            steps {
                sh '''
                    docker push govindthelli/recharge:frontend
                    docker push govindthelli/recharge:backend
                '''
            }
        }
        stage('pull images and up containers') {
            steps {
                sh '''
                    docker compose pull
                    docker compose up -d --force-recreate
                '''
            }
        }
    }
}
